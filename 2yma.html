<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2-Year MA Multiplier â€” BTC Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
<script src="nav.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #13131a;
    --border: #1e1e2e;
    --gold: #f7b731;
    --gold-dim: #a07820;
    --green: #26de81;
    --red: #fc5c65;
    --blue: #74b9ff;
    --purple: #a29bfe;
    --text: #e8e8f0;
    --muted: #5a5a7a;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg); color: var(--text);
    font-family: 'Syne', sans-serif; min-height: 100vh; /* overflow-x: hidden; removed for sidebar layout */
  }

  body::before {
    content: ''; position: fixed; inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
    pointer-events: none; z-index: 999;
  }

  .main { padding: 32px 40px; max-width: 1400px; margin: 0 auto; }

  .page-title { margin-bottom: 28px; }
  .page-title h1 { font-size: 30px; font-weight: 800; margin-bottom: 8px; }
  .page-title h1 span { color: var(--gold); }
  .page-title p { font-size: 14px; color: var(--muted); line-height: 1.8; max-width: 700px; }
  .page-title p strong { color: var(--text); }

  /* stat cards */
  .stats-grid {
    display: grid; grid-template-columns: repeat(4, 1fr);
    gap: 14px; margin-bottom: 24px;
  }
  .stat-card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 12px; padding: 18px 22px;
    position: relative; overflow: hidden;
  }
  .stat-card::before {
    content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; opacity: 0.8;
  }
  .stat-card.c-gold::before   { background: var(--gold); }
  .stat-card.c-green::before  { background: var(--green); }
  .stat-card.c-red::before    { background: var(--red); }
  .stat-card.c-blue::before   { background: var(--blue); }

  .stat-label {
    font-size: 10px; letter-spacing: 0.15em; text-transform: uppercase;
    color: var(--muted); font-family: 'Space Mono', monospace; margin-bottom: 8px;
  }
  .stat-value { font-size: 20px; font-weight: 700; font-family: 'Space Mono', monospace; }
  .stat-sub   { font-size: 11px; color: var(--muted); font-family: 'Space Mono', monospace; margin-top: 4px; }

  /* signal badge */
  .signal-badge {
    display: inline-flex; align-items: center; gap: 8px;
    font-family: 'Space Mono', monospace; font-size: 13px; font-weight: 700;
    padding: 8px 18px; border-radius: 8px; margin-bottom: 24px;
  }
  .signal-badge.buy      { background: rgba(38,222,129,0.12); color: var(--green); border: 1px solid rgba(38,222,129,0.3); }
  .signal-badge.sell     { background: rgba(252,92,101,0.12); color: var(--red);   border: 1px solid rgba(252,92,101,0.3); }
  .signal-badge.neutral  { background: rgba(116,185,255,0.12); color: var(--blue); border: 1px solid rgba(116,185,255,0.3); }

  /* chart */
  .chart-wrap {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 16px; padding: 24px; margin-bottom: 20px;
  height: 420px;
  overflow: hidden;
}
  .chart-label {
    font-size: 12px; letter-spacing: 0.12em; text-transform: uppercase;
    color: var(--muted); font-family: 'Space Mono', monospace; margin-bottom: 16px;
  }
  #maChart { width: 100%; height: 460px; display: block; }

  /* legend explanation */
  .legend-row {
    display: flex; gap: 24px; flex-wrap: wrap;
    margin-bottom: 20px;
  }
  .legend-item {
    display: flex; align-items: center; gap: 8px;
    font-family: 'Space Mono', monospace; font-size: 12px; color: var(--muted);
  }
  .legend-dot {
    width: 28px; height: 3px; border-radius: 2px;
  }

  /* status */
  .status-bar {
    font-family: 'Space Mono', monospace; font-size: 12px; color: var(--muted);
    margin-bottom: 20px; display: flex; align-items: center; gap: 8px;
  }
  .status-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--muted); }
  .status-dot.loading { background: var(--gold); animation: pulse 1s infinite; }
  .status-dot.ready   { background: var(--green); }
  .status-dot.error   { background: var(--red); }
  @keyframes pulse {
    0%,100%{ opacity:1; transform:scale(1); }
    50%     { opacity:0.4; transform:scale(0.8); }
  }

  /* note */
  .note {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 10px; padding: 14px 20px;
    font-family: 'Space Mono', monospace; font-size: 11px;
    color: var(--muted); line-height: 1.9;
  }
  .note strong { color: var(--text); }

  @media (max-width: 900px) { .stats-grid { grid-template-columns: 1fr 1fr; } }
  @media (max-width: 600px) {
    .main { padding: 16px 20px; }
    .stats-grid { grid-template-columns: 1fr 1fr; }
  }
</style>
</head>
<body>

<div id="nav-root"></div>

<div class="main">

  <div class="page-title">
    <h1>2å¹´ç§»åŠ¨å¹³å‡çº¿<span>ä¹˜æ•°</span></h1>
    <p>
      ç”± <strong>Philip Swift</strong> åˆ›å»ºã€‚ä½¿ç”¨ä¸¤æ¡çº¿åˆ’å®š BTC çš„å†å²ä¹°å–åŒºé—´ï¼š
      <strong>730å¤©ç§»åŠ¨å¹³å‡çº¿ï¼ˆç»¿çº¿ï¼‰</strong>æ ‡å‡ºå†å²åº•éƒ¨ä¹°å…¥åŒºï¼Œ
      <strong>730å¤©å‡çº¿ Ã— 5ï¼ˆçº¢çº¿ï¼‰</strong>æ ‡å‡ºå†å²é¡¶éƒ¨è·åˆ©åŒºã€‚
      ä»·æ ¼åœ¨ä¸¤çº¿ä¹‹é—´ä¸ºä¸­æ€§åŒºé—´ã€‚
    </p>
  </div>

  <!-- Signal badge -->
  <div class="signal-badge neutral" id="signalBadge">â³ è®¡ç®—ä¸­...</div>

  <!-- Stats -->
  <div class="stats-grid">
    <div class="stat-card c-gold">
      <div class="stat-label">å½“å‰ BTC ä»·æ ¼</div>
      <div class="stat-value" id="s-price" style="color:var(--gold)">--</div>
    </div>
    <div class="stat-card c-green">
      <div class="stat-label">730å¤©å‡çº¿ï¼ˆä¹°å…¥å‚è€ƒï¼‰</div>
      <div class="stat-value" id="s-ma" style="color:var(--green)">--</div>
      <div class="stat-sub" id="s-ma-dist">è·å‡çº¿ --</div>
    </div>
    <div class="stat-card c-red">
      <div class="stat-label">730å¤©å‡çº¿ Ã— 5ï¼ˆè·åˆ©å‚è€ƒï¼‰</div>
      <div class="stat-value" id="s-ma5" style="color:var(--red)">--</div>
      <div class="stat-sub" id="s-ma5-dist">è·é¡¶çº¿ --</div>
    </div>
    <div class="stat-card c-blue">
      <div class="stat-label">ä»·æ ¼ä½ç½®</div>
      <div class="stat-value" id="s-pos" style="color:var(--blue)">--</div>
      <div class="stat-sub" id="s-pos-sub">åœ¨ä¹°å–åŒºé—´å†…çš„ä½ç½®</div>
    </div>
  </div>

  <!-- Legend -->
  <div class="legend-row">
    <div class="legend-item">
      <div class="legend-dot" style="background:#f7b731"></div>BTC ä»·æ ¼
    </div>
    <div class="legend-item">
      <div class="legend-dot" style="background:#26de81"></div>730å¤©å‡çº¿ï¼ˆä¹°å…¥å‚è€ƒï¼‰
    </div>
    <div class="legend-item">
      <div class="legend-dot" style="background:#fc5c65"></div>730å¤©å‡çº¿ Ã— 5ï¼ˆè·åˆ©å‚è€ƒï¼‰
    </div>
  </div>

  <!-- Status -->
  <div class="status-bar">
    <div class="status-dot loading" id="statusDot"></div>
    <span id="statusText">æ­£åœ¨åŠ è½½æ•°æ®...</span>
  </div>

  <!-- Chart -->
  <div class="chart-wrap">
    <div class="chart-label">ä»·æ ¼ vs 2-Year MA Multiplierï¼ˆå¯¹æ•°åæ ‡ï¼‰</div>
    <canvas id="maChart"></canvas>
  </div>

  <div class="note">
    <strong>è®¡ç®—æ–¹æ³•ï¼š</strong>
    730å¤©ç®€å•ç§»åŠ¨å¹³å‡ï¼ˆSMA730ï¼‰= è¿‡å»730å¤©æ”¶ç›˜ä»·çš„ç®—æœ¯å¹³å‡å€¼ï¼›
    é¡¶éƒ¨çº¿ = SMA730 Ã— 5ã€‚å‡çº¿éœ€è¦è‡³å°‘730å¤©æ•°æ®æ‰èƒ½å¼€å§‹è®¡ç®—ï¼Œå›¾è¡¨ä»æœ‰æ•ˆæ•°æ®èµ·æ˜¾ç¤ºã€‚<br>
    <strong>ä¿¡å·è§£è¯»ï¼š</strong>
    ä»·æ ¼è·Œç ´ç»¿çº¿ â†’ å†å²æ€§ä¹°å…¥æœºä¼šï¼›ä»·æ ¼çªç ´çº¢çº¿ â†’ å†å²æ€§è·åˆ©ç¦»åœºåŒºé—´ã€‚ä¸¤çº¿ä¹‹é—´ä¸ºæ­£å¸¸æ³¢åŠ¨èŒƒå›´ã€‚<br>
    <strong>æ•°æ®æ¥æºï¼š</strong>æœ¬åœ° btc_history.csv + CoinGecko APIï¼ˆè¿‘365å¤©ï¼‰ï¼Œè‡ªåŠ¨åˆå¹¶å»é‡ã€‚<br>
    <strong>æ³¨æ„ï¼š</strong>å†å²è§„å¾‹ä¸ä»£è¡¨æœªæ¥ï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®ã€‚
  </div>

</div>

<script>
renderNav('2yma');

var maChart = null;

function setStatus(state, text) {
  document.getElementById('statusDot').className  = 'status-dot ' + state;
  document.getElementById('statusText').textContent = text;
}

// â”€â”€ å·¥å…·å‡½æ•° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toDateStr(d) { return d.toISOString().substring(0, 10); }

function parseCSV(text) {
  var lines = text.trim().split('\n');
  var result = [];
  for (var i = 1; i < lines.length; i++) {
    var cols  = lines[i].split(',');
    var price = parseFloat(cols[1]);
    if (!price) continue;
    result.push({ dateStr: cols[0].substring(0,10), date: new Date(cols[0]), price: price });
  }
  return result;
}

function parseAPI(data) {
  var result = [];
  for (var i = 0; i < data.prices.length; i++) {
    var price = data.prices[i][1];
    if (!price) continue;
    var d = new Date(data.prices[i][0]);
    result.push({ dateStr: toDateStr(d), date: d, price: price });
  }
  return result;
}

function mergeAndSort(csvDays, apiDays) {
  var apiDates = {};
  apiDays.forEach(function(d) { apiDates[d.dateStr] = true; });
  var merged = csvDays.filter(function(d) { return !apiDates[d.dateStr]; }).concat(apiDays);
  merged.sort(function(a, b) { return a.date - b.date; });
  return merged;
}

// â”€â”€ æ ¸å¿ƒè®¡ç®—ï¼šSMA730 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// SMA730 = è¿‡å»730å¤©ï¼ˆå«å½“å¤©ï¼‰çš„æ”¶ç›˜ä»·å¹³å‡å€¼
// å‰729å¤©æ•°æ®ä¸è¶³ï¼Œè®¾ä¸º nullï¼Œå›¾è¡¨ä¸Šä¸æ˜¾ç¤º
function calcMA(days) {
  var WINDOW = 730;
  for (var i = 0; i < days.length; i++) {
    if (i < WINDOW - 1) {
      days[i].ma  = null;
      days[i].ma5 = null;
    } else {
      var sum = 0;
      for (var j = i - WINDOW + 1; j <= i; j++) { sum += days[j].price; }
      days[i].ma  = sum / WINDOW;
      days[i].ma5 = days[i].ma * 5;
    }
  }
  return days;
}

// â”€â”€ æ›´æ–°ç»Ÿè®¡å¡ç‰‡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateStats(days) {
  var latest = days[days.length - 1];
  var price  = latest.price;
  var ma     = latest.ma;
  var ma5    = latest.ma5;

  document.getElementById('s-price').textContent =
    '$' + price.toLocaleString('en-US', {maximumFractionDigits: 0});
  document.getElementById('s-ma').textContent =
    '$' + ma.toLocaleString('en-US', {maximumFractionDigits: 0});
  document.getElementById('s-ma5').textContent =
    '$' + ma5.toLocaleString('en-US', {maximumFractionDigits: 0});

  // è·ç¦»ç™¾åˆ†æ¯”
  var distMA  = ((price - ma)  / ma  * 100).toFixed(1);
  var distMA5 = ((price - ma5) / ma5 * 100).toFixed(1);
  document.getElementById('s-ma-dist').textContent  =
    (distMA  >= 0 ? 'é«˜äºå‡çº¿ +' : 'ä½äºå‡çº¿ ') + distMA  + '%';
  document.getElementById('s-ma5-dist').textContent =
    (distMA5 >= 0 ? 'é«˜äºé¡¶çº¿ +' : 'ä½äºé¡¶çº¿ ') + distMA5 + '%';

  // ä½ç½®ï¼šä»·æ ¼åœ¨ ma~ma5 åŒºé—´å†…çš„ç™¾åˆ†æ¯”ä½ç½®
  var pos = ((price - ma) / (ma5 - ma) * 100).toFixed(1);
  document.getElementById('s-pos').textContent = pos + '%';
  document.getElementById('s-pos-sub').textContent =
    pos < 0   ? 'ä½äºä¹°å…¥å‚è€ƒçº¿' :
    pos > 100 ? 'é«˜äºè·åˆ©å‚è€ƒçº¿' :
    'å¤„äºæ­£å¸¸åŒºé—´å†…';

  // ä¿¡å·å¾½ç« 
  var badge = document.getElementById('signalBadge');
  if (price <= ma) {
    badge.className   = 'signal-badge buy';
    badge.textContent = 'ğŸŸ¢ ä»·æ ¼ä½äº730å¤©å‡çº¿ â€” å†å²æ€§ä¹°å…¥å‚è€ƒåŒºé—´';
  } else if (price >= ma5) {
    badge.className   = 'signal-badge sell';
    badge.textContent = 'ğŸ”´ ä»·æ ¼çªç ´730å¤©å‡çº¿Ã—5 â€” å†å²æ€§è·åˆ©å‚è€ƒåŒºé—´';
  } else {
    badge.className   = 'signal-badge neutral';
    badge.textContent = 'ğŸ”µ ä»·æ ¼å¤„äºæ­£å¸¸æ³¢åŠ¨åŒºé—´';
  }
}

// â”€â”€ ç”»å›¾ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drawChart(days) {
  // åªå– ma ä¸ä¸º null çš„éƒ¨åˆ†ï¼ˆä»ç¬¬730å¤©èµ·ï¼‰
  var valid = days.filter(function(d) { return d.ma !== null; });

  var priceData = valid.map(function(d) { return { x: d.date, y: Math.round(d.price) }; });
  var maData    = valid.map(function(d) { return { x: d.date, y: Math.round(d.ma)    }; });
  var ma5Data   = valid.map(function(d) { return { x: d.date, y: Math.round(d.ma5)   }; });

  if (maChart) maChart.destroy();

  var ctx = document.getElementById('maChart').getContext('2d');
  maChart = new Chart(ctx, {
    type: 'line',
    data: {
      datasets: [
        {
          label: 'BTC ä»·æ ¼',
          data: priceData,
          borderColor: '#f7b731',
          borderWidth: 1.5,
          pointRadius: 0,
          tension: 0.1,
          fill: false,
          order: 1,
        },
        {
          // ä¸Šä¸‹ä¸¤æ¡çº¿ä¹‹é—´å¡«å……ï¼šma5 å¡«å……åˆ° ma
          label: '730å¤©å‡çº¿ Ã— 5ï¼ˆè·åˆ©å‚è€ƒï¼‰',
          data: ma5Data,
          borderColor: '#fc5c65',
          backgroundColor: 'rgba(252,92,101,0.07)',
          borderWidth: 2,
          pointRadius: 0,
          tension: 0.3,
          fill: '+1',   // å¡«å……åˆ°ä¸‹ä¸€ä¸ªæ•°æ®é›†ï¼ˆmaçº¿ï¼‰
          order: 3,
        },
        {
          label: '730å¤©å‡çº¿ï¼ˆä¹°å…¥å‚è€ƒï¼‰',
          data: maData,
          borderColor: '#26de81',
          backgroundColor: 'rgba(38,222,129,0.07)',
          borderWidth: 2,
          pointRadius: 0,
          tension: 0.3,
          fill: false,
          order: 2,
        },
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: { mode: 'index', intersect: false },
      plugins: {
        legend: {
          labels: {
            color: '#e8e8f0',
            font: { family: 'Space Mono, monospace', size: 12 },
            boxWidth: 24, padding: 20,
          }
        },
        tooltip: {
          backgroundColor: '#13131a',
          borderColor: '#1e1e2e',
          borderWidth: 1,
          titleColor: '#5a5a7a',
          bodyColor: '#e8e8f0',
          callbacks: {
            title: function(items) {
              return new Date(items[0].parsed.x).toLocaleDateString('zh-CN');
            },
            label: function(ctx) {
              return ' ' + ctx.dataset.label + ': $' + ctx.parsed.y.toLocaleString();
            }
          }
        },
        annotation: {
          annotations: {
            // æ ‡æ³¨å†å²ä¸Šçªç ´çº¢çº¿çš„åŒºé—´ï¼ˆé¡¶éƒ¨ï¼‰
            top2013: { type:'line', xMin: new Date('2013-11-01'), xMax: new Date('2013-12-20'), borderColor:'rgba(252,92,101,0.25)', borderWidth:20 },
            top2017: { type:'line', xMin: new Date('2017-11-01'), xMax: new Date('2018-01-20'), borderColor:'rgba(252,92,101,0.25)', borderWidth:20 },
            top2021: { type:'line', xMin: new Date('2021-02-01'), xMax: new Date('2021-05-01'), borderColor:'rgba(252,92,101,0.25)', borderWidth:20 },
          }
        }
      },
      scales: {
        x: {
          type: 'time',
          time: { unit: 'year' },
          ticks: { color: '#5a5a7a', font: { family: 'Space Mono, monospace' } },
          grid:  { color: '#1e1e2e' },
        },
        y: {
          type: 'logarithmic',
          position: 'right',
          ticks: {
            color: '#5a5a7a',
            font: { family: 'Space Mono, monospace' },
            callback: function(v) {
              var neat = [100, 500, 1000, 5000, 10000, 50000, 100000, 500000];
              return neat.indexOf(v) >= 0 ? '$' + v.toLocaleString() : '';
            }
          },
          grid: { color: '#1e1e2e' },
        }
      }
    }
  });
}

// â”€â”€ ä¸»æµç¨‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Promise.all([
  fetch('btc_history.csv').then(function(r) { return r.text(); }),
  fetch('https://api.coingecko.com/api/v3/coins/bitcoin/market_chart?vs_currency=usd&days=365&interval=daily')
    .then(function(r) { return r.json(); })
])
.then(function(results) {
  setStatus('loading', 'è®¡ç®— 730å¤©å‡çº¿ ä¸­...');
  var csvDays = parseCSV(results[0]);
  var apiDays = parseAPI(results[1]);
  var merged  = mergeAndSort(csvDays, apiDays);
  var days    = calcMA(merged);

  setStatus('ready', 'âœ… æ•°æ®å°±ç»ª â€” å…± ' + days.length + ' å¤©ï¼Œå‡çº¿ä»ç¬¬730å¤©èµ·æœ‰æ•ˆ');
  updateStats(days);
  drawChart(days);
})
.catch(function() {
  setStatus('error', 'âŒ åŠ è½½å¤±è´¥ï¼šè¯·ç¡®è®¤ btc_history.csv åœ¨åŒä¸€æ–‡ä»¶å¤¹ï¼Œå¹¶é€šè¿‡ Python æœåŠ¡å™¨è®¿é—®');
});
</script>
</body>
</html>
