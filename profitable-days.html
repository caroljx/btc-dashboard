<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ¯”ç‰¹å¸ç›ˆåˆ©å¤©æ•° â€” BTC Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
<script src="nav.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f; --surface: #13131a; --border: #1e1e2e;
    --gold: #f7b731; --green: #26de81; --red: #fc5c65;
    --blue: #74b9ff; --purple: #a29bfe; --text: #e8e8f0; --muted: #5a5a7a;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: var(--bg); color: var(--text); font-family: 'Syne', sans-serif; min-height: 100vh; /* overflow-x: hidden; removed for sidebar layout */ }
  body::before {
    content: ''; position: fixed; inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
    pointer-events: none; z-index: 999;
  }
  .main { padding: 32px 40px; max-width: 1400px; margin: 0 auto; }

  .page-title { margin-bottom: 28px; }
  .page-title h1 { font-size: 30px; font-weight: 800; margin-bottom: 8px; }
  .page-title h1 span { color: var(--gold); }
  .page-title p { font-size: 14px; color: var(--muted); line-height: 1.8; max-width: 700px; }
  .page-title p strong { color: var(--text); }

  /* å¤§å·æ¯”ä¾‹æ˜¾ç¤º */
  .hero-row {
    display: flex; gap: 16px; margin-bottom: 24px; flex-wrap: wrap;
  }
  .hero-card {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 16px; padding: 28px 32px; flex: 1; min-width: 200px;
    position: relative; overflow: hidden;
  }
  .hero-card::before {
    content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
  }
  .hero-card.c-green::before  { background: var(--green); }
  .hero-card.c-red::before    { background: var(--red); }
  .hero-card.c-gold::before   { background: var(--gold); }
  .hero-card.c-purple::before { background: var(--purple); }

  .hero-label { font-size: 10px; letter-spacing: 0.15em; text-transform: uppercase; color: var(--muted); font-family: 'Space Mono', monospace; margin-bottom: 10px; }
  .hero-value { font-size: 42px; font-weight: 800; font-family: 'Space Mono', monospace; line-height: 1; }
  .hero-sub   { font-size: 12px; color: var(--muted); font-family: 'Space Mono', monospace; margin-top: 8px; }

  /* è¿›åº¦æ¡ */
  .progress-wrap { margin-bottom: 24px; }
  .progress-label {
    display: flex; justify-content: space-between;
    font-family: 'Space Mono', monospace; font-size: 11px; color: var(--muted);
    margin-bottom: 8px;
  }
  .progress-bar {
    height: 16px; border-radius: 8px; background: var(--surface);
    border: 1px solid var(--border); overflow: hidden; position: relative;
  }
  .progress-fill {
    height: 100%; border-radius: 8px;
    background: linear-gradient(90deg, var(--green), #1aaf5d);
    transition: width 1s ease;
  }
  .progress-marker {
    position: absolute; top: 0; bottom: 0; width: 2px; background: rgba(255,255,255,0.3);
  }

  /* chart */
  .chart-wrap {
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 16px; padding: 24px; margin-bottom: 20px;
    height: 460px; overflow: hidden;
  }
  .chart-label { font-size: 12px; letter-spacing: 0.12em; text-transform: uppercase; color: var(--muted); font-family: 'Space Mono', monospace; margin-bottom: 16px; }
  #pdChart { width: 100%; height: 380px; display: block; }

  /* legend */
  .legend-row { display: flex; gap: 20px; margin-bottom: 16px; flex-wrap: wrap; }
  .legend-item { display: flex; align-items: center; gap: 8px; font-family: 'Space Mono', monospace; font-size: 11px; color: var(--muted); }
  .legend-dot  { width: 12px; height: 12px; border-radius: 2px; }

  /* status */
  .status-bar { font-family: 'Space Mono', monospace; font-size: 12px; color: var(--muted); margin-bottom: 20px; display: flex; align-items: center; gap: 8px; }
  .status-dot { width: 6px; height: 6px; border-radius: 50%; }
  .status-dot.loading { background: var(--gold); animation: pulse 1s infinite; }
  .status-dot.ready   { background: var(--green); }
  .status-dot.error   { background: var(--red); }
  @keyframes pulse { 0%,100%{ opacity:1; transform:scale(1); } 50%{ opacity:0.4; transform:scale(0.8); } }

  /* note */
  .note { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 14px 20px; font-family: 'Space Mono', monospace; font-size: 11px; color: var(--muted); line-height: 1.9; }
  .note strong { color: var(--text); }

  @media (max-width: 900px) { .hero-row { flex-wrap: wrap; } .hero-value { font-size: 32px; } }
  @media (max-width: 600px) { .main { padding: 16px 20px; } }
</style>
</head>
<body>

<div id="nav-root"></div>

<div class="main">
  <div class="page-title">
    <h1>æ¯”ç‰¹å¸ <span>ç›ˆåˆ©å¤©æ•°</span></h1>
    <p>
      ç”± <strong>@Rhythmtrader</strong> åˆ›å»ºã€‚ä»¥<strong>ä»Šå¤©çš„ä»·æ ¼</strong>ä¸ºåŸºå‡†ï¼Œ
      ç»Ÿè®¡å†å²ä¸Šæ¯ä¸€å¤©ä¹°å…¥ã€æŒæœ‰è‡³ä»Šæ˜¯å¦ç›ˆåˆ©ã€‚
      ç»¿è‰² = ç›ˆåˆ©æ—¥ï¼ˆä¹°å…¥ä»·ä½äºä»Šå¤©ï¼‰ï¼Œçº¢è‰² = äºæŸæ—¥ï¼ˆä¹°å…¥ä»·é«˜äºä»Šå¤©ï¼‰ã€‚
      å†å²ä¸Šçº¦ <strong>95%</strong> çš„æ—¶é—´ä¹°å…¥æ¯”ç‰¹å¸ï¼ŒæŒæœ‰è‡³ä»Šéƒ½æ˜¯ç›ˆåˆ©çš„ã€‚
    </p>
  </div>

  <!-- Hero cards -->
  <div class="hero-row">
    <div class="hero-card c-green">
      <div class="hero-label">ç›ˆåˆ©å¤©æ•°</div>
      <div class="hero-value" id="h-profitable" style="color:var(--green)">--</div>
      <div class="hero-sub" id="h-profitable-pct">å å†å²æ€»å¤©æ•° --%</div>
    </div>
    <div class="hero-card c-red">
      <div class="hero-label">äºæŸå¤©æ•°</div>
      <div class="hero-value" id="h-loss" style="color:var(--red)">--</div>
      <div class="hero-sub" id="h-loss-pct">å å†å²æ€»å¤©æ•° --%</div>
    </div>
    <div class="hero-card c-gold">
      <div class="hero-label">ä»Šæ—¥å‚è€ƒä»·æ ¼</div>
      <div class="hero-value" id="h-price" style="color:var(--gold)">--</div>
      <div class="hero-sub">Binance å®æ—¶ä»·æ ¼</div>
    </div>
    <div class="hero-card c-purple">
      <div class="hero-label">å†å²æ€»å¤©æ•°</div>
      <div class="hero-value" id="h-total" style="color:var(--purple)">--</div>
      <div class="hero-sub" id="h-range">-- è‡³ä»Š</div>
    </div>
  </div>

  <!-- è¿›åº¦æ¡ -->
  <div class="progress-wrap">
    <div class="progress-label">
      <span style="color:var(--green)">ğŸŸ¢ ç›ˆåˆ©</span>
      <span id="progress-text" style="color:var(--muted)">è®¡ç®—ä¸­...</span>
      <span style="color:var(--red)">äºæŸ ğŸ”´</span>
    </div>
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill" style="width:0%"></div>
    </div>
  </div>

  <!-- Legend -->
  <div class="legend-row">
    <div class="legend-item">
      <div class="legend-dot" style="background:rgba(38,222,129,0.8)"></div>ç›ˆåˆ©æ—¥ï¼ˆä¹°å…¥ä»· &lt; ä»Šæ—¥ä»·ï¼‰
    </div>
    <div class="legend-item">
      <div class="legend-dot" style="background:rgba(252,92,101,0.8)"></div>äºæŸæ—¥ï¼ˆä¹°å…¥ä»· &gt; ä»Šæ—¥ä»·ï¼‰
    </div>
    <div class="legend-item">
      <div class="legend-dot" style="background:rgba(247,183,49,0.9);width:28px;height:3px;border-radius:2px"></div>BTC ä»·æ ¼æ›²çº¿
    </div>
  </div>

  <!-- Status -->
  <div class="status-bar">
    <div class="status-dot loading" id="statusDot"></div>
    <span id="statusText">æ­£åœ¨åŠ è½½æ•°æ®...</span>
  </div>

  <!-- Chart -->
  <div class="chart-wrap">
    <div class="chart-label">å†å²ç›ˆäºåˆ†å¸ƒï¼ˆç»¿=ç›ˆåˆ© çº¢=äºæŸï¼‰+ BTCä»·æ ¼æ›²çº¿</div>
    <canvas id="pdChart"></canvas>
  </div>

  <div class="note">
    <strong>è®¡ç®—æ–¹å¼ï¼š</strong>ä»¥ Binance å®æ—¶ä»·æ ¼ä¸ºåŸºå‡†ï¼Œå†å²ä¸Šæ¯ä¸€å¤©çš„æ”¶ç›˜ä»·ä½äºä»Šæ—¥ä»·æ ¼å³ä¸º"ç›ˆåˆ©æ—¥"ï¼ˆç»¿è‰²ï¼‰ï¼Œé«˜äºä»Šæ—¥ä»·æ ¼å³ä¸º"äºæŸæ—¥"ï¼ˆçº¢è‰²ï¼‰ã€‚<br>
    <strong>æ•°æ®æ¥æºï¼š</strong>å†å²ä»·æ ¼æ¥è‡ªæœ¬åœ° btc_history.csvï¼ˆCoinGeckoï¼‰ï¼Œä»Šæ—¥å®æ—¶ä»·æ ¼æ¥è‡ª Binance APIã€‚<br>
    <strong>åˆ›å»ºè€…ï¼š</strong>@Rhythmtraderã€‚æœ¬å›¾ä»…ä¾›å‚è€ƒï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®ã€‚
  </div>
</div>

<script>
renderNav('profitable-days');

var pdChart = null;

function setStatus(state, text) {
  document.getElementById('statusDot').className    = 'status-dot ' + state;
  document.getElementById('statusText').textContent = text;
}

// â”€â”€ è§£æCSV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function parseCSV(text) {
  var lines = text.trim().split('\n');
  var days  = [];
  for (var i = 1; i < lines.length; i++) {
    var line  = lines[i].replace('\r', '');
    var cols  = line.split(',');
    var price = parseFloat(cols[1]);
    if (!price) continue;
    days.push({
      date:    new Date(cols[0]),
      dateStr: cols[0].substring(0, 10),
      price:   price,
    });
  }
  return days;
}

// â”€â”€ æ ¸å¿ƒè®¡ç®— â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//
// ä»¥ä»Šå¤©å®æ—¶ä»·æ ¼ä¸ºåŸºå‡†ï¼š
//   å†å²æ”¶ç›˜ä»· < ä»Šæ—¥ä»·  â†’ ç»¿è‰²ï¼ˆç›ˆåˆ©ï¼‰
//   å†å²æ”¶ç›˜ä»· > ä»Šæ—¥ä»·  â†’ çº¢è‰²ï¼ˆäºæŸï¼‰
//   å†å²æ”¶ç›˜ä»· = ä»Šæ—¥ä»·  â†’ ç°è‰²ï¼ˆæŒå¹³ï¼Œæå°‘è§ï¼‰

function calcProfitable(days, todayPrice) {
  var profitable = 0;
  var loss       = 0;

  days.forEach(function(d) {
    if (d.price < todayPrice) {
      d.color     = 'rgba(38,222,129,0.75)';
      d.profitable = true;
      profitable++;
    } else if (d.price > todayPrice) {
      d.color     = 'rgba(252,92,101,0.75)';
      d.profitable = false;
      loss++;
    } else {
      d.color     = 'rgba(90,90,122,0.75)';
      d.profitable = null;
    }
  });

  return { days: days, profitable: profitable, loss: loss };
}

// â”€â”€ æ›´æ–°ç»Ÿè®¡å¡ç‰‡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateStats(result, todayPrice, totalDays, firstDate) {
  var pct = (result.profitable / totalDays * 100).toFixed(1);
  var lct = (result.loss       / totalDays * 100).toFixed(1);

  document.getElementById('h-profitable').textContent     = result.profitable.toLocaleString();
  document.getElementById('h-profitable-pct').textContent = 'å å†å²æ€»å¤©æ•° ' + pct + '%';
  document.getElementById('h-loss').textContent            = result.loss.toLocaleString();
  document.getElementById('h-loss-pct').textContent        = 'å å†å²æ€»å¤©æ•° ' + lct + '%';
  document.getElementById('h-price').textContent           = '$' + todayPrice.toLocaleString('en-US', {maximumFractionDigits: 0});
  document.getElementById('h-total').textContent           = totalDays.toLocaleString();
  document.getElementById('h-range').textContent           = firstDate + ' è‡³ä»Š';

  // è¿›åº¦æ¡
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('progress-text').textContent =
    pct + '% ç›ˆåˆ© / ' + lct + '% äºæŸ';
}

// â”€â”€ ç”»å›¾ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//
// æ•£ç‚¹å›¾ï¼šæ¯å¤©ä¸€ä¸ªç‚¹ï¼Œé¢œè‰²ä»£è¡¨ç›ˆäº
// åŒæ—¶ç”»ä¸€æ¡é‡‘è‰²ä»·æ ¼çº¿
// åŠ ä¸€æ¡ä»Šæ—¥ä»·æ ¼çš„æ°´å¹³å‚è€ƒçº¿

function drawChart(days, todayPrice) {
  var scatterData  = days.map(function(d) { return { x: d.date, y: d.price }; });
  var pointColors  = days.map(function(d) { return d.color; });
  var priceLineData = days.map(function(d) { return { x: d.date, y: d.price }; });

  if (pdChart) pdChart.destroy();

  var ctx = document.getElementById('pdChart').getContext('2d');
  pdChart = new Chart(ctx, {
    type: 'scatter',
    data: {
      datasets: [
        {
          // æ•£ç‚¹ï¼šé¢œè‰²ä»£è¡¨ç›ˆäº
          label: 'å†å²ä»·æ ¼ï¼ˆç»¿=ç›ˆåˆ© çº¢=äºæŸï¼‰',
          data: scatterData,
          pointBackgroundColor: pointColors,
          pointBorderColor:     pointColors,
          pointRadius: 2,
          pointHoverRadius: 5,
          type: 'scatter',
          yAxisID: 'y',
          order: 1,
        },
        {
          // é‡‘è‰²ä»·æ ¼çº¿
          label: 'BTC ä»·æ ¼æ›²çº¿',
          data: priceLineData,
          type: 'line',
          borderColor: 'rgba(0,0,0,1)',
          backgroundColor: 'transparent',
          borderWidth: 1,
          pointRadius: 0,
          tension: 0.2,
          yAxisID: 'y',
          order: 3,
        },
        {
          // ä»Šæ—¥ä»·æ ¼æ°´å¹³å‚è€ƒçº¿ï¼ˆç”¨æŠ˜çº¿æ¨¡æ‹Ÿï¼‰
          label: 'ä»Šæ—¥ä»·æ ¼ $' + todayPrice.toLocaleString('en-US', {maximumFractionDigits: 0}),
          data: [
            { x: days[0].date,                   y: todayPrice },
            { x: days[days.length - 1].date,     y: todayPrice },
          ],
          type: 'line',
          borderColor: 'rgba(255,255,255,0.4)',
          backgroundColor: 'transparent',
          borderWidth: 1.5,
          borderDash: [6, 4],
          pointRadius: 0,
          yAxisID: 'y',
          order: 2,
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          labels: {
            color: '#e8e8f0',
            font: { family: 'Space Mono, monospace', size: 11 },
            boxWidth: 20, padding: 16,
            usePointStyle: true,
          }
        },
        tooltip: {
          backgroundColor: '#13131a',
          borderColor: '#1e1e2e',
          borderWidth: 1,
          titleColor: '#5a5a7a',
          bodyColor: '#e8e8f0',
          filter: function(item) {
            // åªå¯¹æ•£ç‚¹å›¾æ˜¾ç¤ºtooltipï¼Œå‚è€ƒçº¿ä¸æ˜¾ç¤º
            return item.datasetIndex === 0;
          },
          callbacks: {
            title: function(items) {
              return new Date(items[0].parsed.x).toLocaleDateString('zh-CN');
            },
            label: function(ctx) {
              var price = ctx.parsed.y;
              var idx   = ctx.dataIndex;
              var d     = days[idx];
              var diff  = ((todayPrice - price) / price * 100).toFixed(1);
              return [
                ' å½“æ—¶ä¹°å…¥ä»·: $' + price.toLocaleString('en-US', {maximumFractionDigits: 0}),
                d.profitable === true
                  ? ' âœ… ç›ˆåˆ© +' + diff + '%ï¼ˆæŒæœ‰è‡³ä»Šï¼‰'
                  : ' âŒ äºæŸ ' + diff + '%ï¼ˆæŒæœ‰è‡³ä»Šï¼‰',
              ];
            }
          }
        }
      },
      scales: {
        x: {
          type: 'time',
          time: { unit: 'year' },
          ticks: { color: '#5a5a7a', font: { family: 'Space Mono, monospace' } },
          grid:  { color: '#1e1e2e' },
        },
        y: {
          type: 'logarithmic',
          position: 'right',
          ticks: {
            color: '#5a5a7a',
            font: { family: 'Space Mono, monospace' },
            callback: function(v) {
              var neat = [100, 500, 1000, 5000, 10000, 50000, 100000];
              return neat.indexOf(v) >= 0 ? '$' + v.toLocaleString() : '';
            }
          },
          grid: { color: '#1e1e2e' },
        }
      }
    }
  });
}

// â”€â”€ ä¸»æµç¨‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Promise.all([
  fetch('https://caroljx.github.io/btc-dashboard/btc_history.csv')
    .then(function(r) { return r.text(); }),
  fetch('https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT')
    .then(function(r) { return r.json(); })
])
.then(function(results) {
  var days       = parseCSV(results[0]);
  var todayPrice = parseFloat(results[1].price);

  if (!days.length || !todayPrice) {
    setStatus('error', 'âŒ æ•°æ®è§£æå¤±è´¥');
    return;
  }

  var result    = calcProfitable(days, todayPrice);
  var totalDays = days.length;
  var firstDate = days[0].dateStr;
  var pct       = (result.profitable / totalDays * 100).toFixed(1);

  setStatus('ready',
    'âœ… è®¡ç®—å®Œæˆ â€” å…± ' + totalDays + ' å¤©å†å²æ•°æ®ï¼Œ' +
    'ä»Šæ—¥ä»·æ ¼ $' + todayPrice.toLocaleString('en-US', {maximumFractionDigits: 0}) + 'ï¼Œ' +
    'ç›ˆåˆ©å¤©æ•° ' + pct + '%'
  );

  updateStats(result, todayPrice, totalDays, firstDate);
  drawChart(result.days, todayPrice);
})
.catch(function(err) {
  setStatus('error', 'âŒ åŠ è½½å¤±è´¥ï¼š' + err.message);
});
</script>
</body>
</html>
