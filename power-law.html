<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ¯”ç‰¹å¸å¹‚å¾‹æ¨¡å‹ â€” BTC Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
<script src="nav.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f; --surface: #13131a; --border: #1e1e2e;
    --gold: #f7b731; --green: #26de81; --red: #fc5c65;
    --blue: #74b9ff; --purple: #a29bfe; --text: #e8e8f0; --muted: #5a5a7a;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: var(--bg); color: var(--text); font-family: 'Syne', sans-serif; min-height: 100vh; overflow-x: hidden; }
  body::before {
    content: ''; position: fixed; inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
    pointer-events: none; z-index: 999;
  }
  .main { padding: 32px 40px; max-width: 1400px; margin: 0 auto; }

  .page-title { margin-bottom: 28px; }
  .page-title h1 { font-size: 30px; font-weight: 800; margin-bottom: 8px; }
  .page-title h1 span { color: var(--gold); }
  .page-title p { font-size: 14px; color: var(--muted); line-height: 1.8; max-width: 720px; }
  .page-title p strong { color: var(--text); }

  /* stats */
  .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 14px; margin-bottom: 24px; }
  .stat-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 18px 22px; position: relative; overflow: hidden; }
  .stat-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; opacity: 0.8; }
  .stat-card.c-gold::before   { background: var(--gold); }
  .stat-card.c-blue::before   { background: var(--blue); }
  .stat-card.c-green::before  { background: var(--green); }
  .stat-card.c-red::before    { background: var(--red); }
  .stat-card.c-purple::before { background: var(--purple); }
  .stat-label { font-size: 10px; letter-spacing: 0.15em; text-transform: uppercase; color: var(--muted); font-family: 'Space Mono', monospace; margin-bottom: 8px; }
  .stat-value { font-size: 18px; font-weight: 700; font-family: 'Space Mono', monospace; }
  .stat-sub   { font-size: 11px; color: var(--muted); font-family: 'Space Mono', monospace; margin-top: 4px; }

  /* å½“å‰ä½ç½®ä¿¡å· */
  .signal-badge {
    display: inline-flex; align-items: center; gap: 10px;
    padding: 12px 20px; border-radius: 10px; margin-bottom: 24px;
    font-family: 'Space Mono', monospace; font-size: 13px; font-weight: 700;
    border: 1px solid rgba(255,255,255,0.1);
  }

  /* legend */
  .legend-row { display: flex; gap: 24px; flex-wrap: wrap; margin-bottom: 16px; }
  .legend-item { display: flex; align-items: center; gap: 8px; font-family: 'Space Mono', monospace; font-size: 11px; color: var(--muted); }
  .legend-line { width: 28px; height: 3px; border-radius: 2px; }

  /* chart */
  .chart-wrap { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 24px; margin-bottom: 20px; height: 500px; overflow: hidden; }
  .chart-label { font-size: 12px; letter-spacing: 0.12em; text-transform: uppercase; color: var(--muted); font-family: 'Space Mono', monospace; margin-bottom: 16px; }
  #plChart { width: 100%; height: 420px; display: block; }

  /* status */
  .status-bar { font-family: 'Space Mono', monospace; font-size: 12px; color: var(--muted); margin-bottom: 20px; display: flex; align-items: center; gap: 8px; }
  .status-dot { width: 6px; height: 6px; border-radius: 50%; }
  .status-dot.loading { background: var(--gold); animation: pulse 1s infinite; }
  .status-dot.ready   { background: var(--green); }
  .status-dot.error   { background: var(--red); }
  @keyframes pulse { 0%,100%{ opacity:1; transform:scale(1); } 50%{ opacity:0.4; transform:scale(0.8); } }

  /* note */
  .note { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 14px 20px; font-family: 'Space Mono', monospace; font-size: 11px; color: var(--muted); line-height: 1.9; }
  .note strong { color: var(--text); }

  @media (max-width: 900px) { .stats-grid { grid-template-columns: 1fr 1fr; } }
  @media (max-width: 600px) { .main { padding: 16px 20px; } .stats-grid { grid-template-columns: 1fr 1fr; } }
</style>
</head>
<body>

<div id="nav-root"></div>

<div class="main">
  <div class="page-title">
    <h1>æ¯”ç‰¹å¸ <span>å¹‚å¾‹æ¨¡å‹</span></h1>
    <p>
      <strong>å¹‚å¾‹ï¼ˆPower Lawï¼‰</strong>æ¨¡å‹è®¤ä¸ºï¼Œæ¯”ç‰¹å¸ä»·æ ¼ä¸æ—¶é—´ä¹‹é—´å­˜åœ¨å¹‚å‡½æ•°å…³ç³»ã€‚
      åœ¨åŒå¯¹æ•°åæ ‡ä¸‹ï¼Œä»·æ ¼èµ°åŠ¿è¿‘ä¼¼ä¸€æ¡ç›´çº¿ï¼Œç”±å†å²æ•°æ®å›å½’æ‹Ÿåˆè€Œæˆã€‚
      å›¾è¡¨åŒ…å«<strong>ä¸­å¿ƒå›å½’çº¿</strong>ï¼ˆé•¿æœŸå…¬å…ä»·å€¼ï¼‰ã€
      <strong>ä¸Šè¾¹ç•Œ</strong>ï¼ˆå†å²è¿‡çƒ­åŒºï¼‰å’Œ<strong>ä¸‹è¾¹ç•Œ</strong>ï¼ˆå†å²ä½ä¼°åŒºï¼‰ï¼Œ
      å¹¶å»¶ä¼¸è‡³2035å¹´ä½œä¸ºé•¿æœŸå‚è€ƒã€‚
    </p>
  </div>

  <!-- ä¿¡å·å¾½ç«  -->
  <div class="signal-badge" id="signalBadge">â³ è®¡ç®—ä¸­...</div>

  <!-- Stats -->
  <div class="stats-grid">
    <div class="stat-card c-gold">
      <div class="stat-label">ä»Šæ—¥ä»·æ ¼</div>
      <div class="stat-value" id="s-price" style="color:var(--gold)">--</div>
      <div class="stat-sub">Binance å®æ—¶</div>
    </div>
    <div class="stat-card c-blue">
      <div class="stat-label">ä¸­å¿ƒå›å½’çº¿ï¼ˆä»Šæ—¥ï¼‰</div>
      <div class="stat-value" id="s-center" style="color:var(--blue)">--</div>
      <div class="stat-sub">å¹‚å¾‹é•¿æœŸå…¬å…ä»·å€¼</div>
    </div>
    <div class="stat-card c-green">
      <div class="stat-label">ä¸‹è¾¹ç•Œï¼ˆä»Šæ—¥ï¼‰</div>
      <div class="stat-value" id="s-lower" style="color:var(--green)">--</div>
      <div class="stat-sub">å†å²æ”¯æ’‘/ä½ä¼°åŒº</div>
    </div>
    <div class="stat-card c-red">
      <div class="stat-label">ä¸Šè¾¹ç•Œï¼ˆä»Šæ—¥ï¼‰</div>
      <div class="stat-value" id="s-upper" style="color:var(--red)">--</div>
      <div class="stat-sub">å†å²é˜»åŠ›/è¿‡çƒ­åŒº</div>
    </div>
  </div>

  <!-- Legend -->
  <div class="legend-row">
    <div class="legend-item">
      <div class="legend-line" style="background:#f7b731"></div>BTC ä»·æ ¼
    </div>
    <div class="legend-item">
      <div class="legend-line" style="background:#74b9ff"></div>ä¸­å¿ƒå›å½’çº¿
    </div>
    <div class="legend-item">
      <div class="legend-line" style="background:#fc5c65;opacity:0.7"></div>ä¸Šè¾¹ç•Œ
    </div>
    <div class="legend-item">
      <div class="legend-line" style="background:#26de81;opacity:0.7"></div>ä¸‹è¾¹ç•Œ
    </div>
  </div>

  <!-- Status -->
  <div class="status-bar">
    <div class="status-dot loading" id="statusDot"></div>
    <span id="statusText">æ­£åœ¨åŠ è½½æ•°æ®å¹¶æ‹Ÿåˆå›å½’...</span>
  </div>

  <!-- Chart -->
  <div class="chart-wrap">
    <div class="chart-label">æ¯”ç‰¹å¸å¹‚å¾‹æ¨¡å‹ï¼ˆåŒå¯¹æ•°åæ ‡ï¼Œå»¶ä¼¸è‡³2035å¹´ï¼‰</div>
    <canvas id="plChart"></canvas>
  </div>

  <div class="note">
    <strong>è®¡ç®—æ–¹æ³•ï¼š</strong>
    ä»¥2009å¹´1æœˆ3æ—¥ï¼ˆåˆ›ä¸–å—ï¼‰ä¸ºèµ·ç‚¹ï¼Œå¯¹å†å²æ¯æ—¥æ”¶ç›˜ä»·åšæœ€å°äºŒä¹˜æ³•åŒå¯¹æ•°çº¿æ€§å›å½’ï¼š
    logâ‚â‚€(price) = a Ã— logâ‚â‚€(days) + bï¼Œä»æ•°æ®ä¸­è‡ªåŠ¨æ‹Ÿåˆç³»æ•° a å’Œ bã€‚<br>
    <strong>è¾¹ç•Œåˆ’åˆ†ï¼š</strong>ä¸Šè¾¹ç•Œ = å›å½’ä»·æ ¼ Ã— ä¸Šå€æ•°ï¼Œä¸‹è¾¹ç•Œ = å›å½’ä»·æ ¼ Ã— ä¸‹å€æ•°ï¼Œ
    å€æ•°ç”±å†å²ä»·æ ¼å³°è°·ç›¸å¯¹å›å½’çº¿çš„åå·®ç¡®å®šã€‚<br>
    <strong>æ•°æ®æ¥æºï¼š</strong>å†å²ä»·æ ¼æ¥è‡ª btc_history.csvï¼Œä»Šæ—¥å®æ—¶ä»·æ ¼æ¥è‡ª Binance APIã€‚<br>
    <strong>æ³¨æ„ï¼š</strong>å¹‚å¾‹æ¨¡å‹å‡è®¾æ¯”ç‰¹å¸æŒç»­å¢é•¿ï¼Œä¸ä¿è¯æœªæ¥ç»§ç»­éµå¾ªå†å²è§„å¾‹ï¼Œä¸æ„æˆæŠ•èµ„å»ºè®®ã€‚
  </div>
</div>

<script>
renderNav('power-law');

var plChart   = null;
var GENESIS   = new Date('2009-01-03');  // æ¯”ç‰¹å¸åˆ›ä¸–å—æ—¥æœŸ

function setStatus(state, text) {
  document.getElementById('statusDot').className    = 'status-dot ' + state;
  document.getElementById('statusText').textContent = text;
}

// â”€â”€ å·¥å…·ï¼šè®¡ç®—è·åˆ›ä¸–å—çš„å¤©æ•° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function daysSinceGenesis(date) {
  return Math.max(1, (date - GENESIS) / (1000 * 60 * 60 * 24));
}

// â”€â”€ è§£æCSV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function parseCSV(text) {
  var lines = text.trim().split('\n');
  var days  = [];
  for (var i = 1; i < lines.length; i++) {
    var line  = lines[i].replace('\r', '');
    var cols  = line.split(',');
    var price = parseFloat(cols[1]);
    if (!price || price <= 0) continue;
    days.push({ date: new Date(cols[0]), price: price });
  }
  return days;
}

// â”€â”€ æœ€å°äºŒä¹˜æ³•åŒå¯¹æ•°çº¿æ€§å›å½’ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//
// åœ¨ log-log ç©ºé—´åšçº¿æ€§å›å½’ï¼š
//   Y = log10(price),  X = log10(days)
//   æ‹Ÿåˆ: Y = a * X + b
//
// æœ€å°äºŒä¹˜è§£ï¼š
//   a = (n*Î£XY - Î£X*Î£Y) / (n*Î£XÂ² - (Î£X)Â²)
//   b = (Î£Y - a*Î£X) / n

function fitPowerLaw(days) {
  var n = days.length;
  var sumX = 0, sumY = 0, sumXY = 0, sumX2 = 0;

  days.forEach(function(d) {
    var x = Math.log10(daysSinceGenesis(d.date));
    var y = Math.log10(d.price);
    sumX  += x;
    sumY  += y;
    sumXY += x * y;
    sumX2 += x * x;
  });

  var a = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
  var b = (sumY - a * sumX) / n;

  return { a: a, b: b };
}

// â”€â”€ æ ¹æ®å›å½’ç³»æ•°è®¡ç®—æŸå¤©çš„é¢„æµ‹ä»·æ ¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function regressionPrice(date, a, b) {
  var x = Math.log10(daysSinceGenesis(date));
  return Math.pow(10, a * x + b);
}

// â”€â”€ æ ¹æ®å†å²åå·®ç¡®å®šä¸Šä¸‹è¾¹ç•Œå€æ•° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//
// éå†æ‰€æœ‰å†å²æ•°æ®ï¼Œæ‰¾å‡º price/regressionPrice çš„æœ€å¤§å€¼å’Œæœ€å°å€¼
// ä¸Šå€æ•° = å†å²æœ€å¤§æ¯”å€¼ï¼ˆé€‚å½“å–90ç™¾åˆ†ä½é¿å…æç«¯å™ªéŸ³ï¼‰
// ä¸‹å€æ•° = å†å²æœ€å°æ¯”å€¼

function calcBandMultipliers(days, a, b) {
  var ratios = days.map(function(d) {
    return d.price / regressionPrice(d.date, a, b);
  });
  ratios.sort(function(x, y) { return x - y; });

  // å–90ç™¾åˆ†ä½ä½œä¸ºä¸Šè¾¹ç•Œï¼ˆé¿å…æç«¯å™ªéŸ³ï¼‰ï¼Œå–10ç™¾åˆ†ä½ä½œä¸ºä¸‹è¾¹ç•Œ
  var upperIdx = Math.floor(ratios.length * 0.90);
  var lowerIdx = Math.floor(ratios.length * 0.10);

  return {
    upper: ratios[upperIdx],
    lower: ratios[lowerIdx],
  };
}

// â”€â”€ æ›´æ–°ç»Ÿè®¡å¡ç‰‡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateStats(todayPrice, a, b, mult) {
  var today   = new Date();
  var center  = regressionPrice(today, a, b);
  var upper   = center * mult.upper;
  var lower   = center * mult.lower;
  var ratio   = todayPrice / center;

  document.getElementById('s-price').textContent  = '$' + todayPrice.toLocaleString('en-US', {maximumFractionDigits: 0});
  document.getElementById('s-center').textContent = '$' + center.toLocaleString('en-US', {maximumFractionDigits: 0});
  document.getElementById('s-upper').textContent  = '$' + upper.toLocaleString('en-US', {maximumFractionDigits: 0});
  document.getElementById('s-lower').textContent  = '$' + lower.toLocaleString('en-US', {maximumFractionDigits: 0});

  // ä¿¡å·å¾½ç« 
  var badge  = document.getElementById('signalBadge');
  var signal, bgColor, textColor;

  if (todayPrice < lower) {
    signal    = 'ğŸŸ¢ ä»·æ ¼ä½äºä¸‹è¾¹ç•Œ â€” å†å²æåº¦ä½ä¼°åŒº';
    bgColor   = 'rgba(38,222,129,0.12)';
    textColor = '#26de81';
  } else if (todayPrice > upper) {
    signal    = 'ğŸ”´ ä»·æ ¼é«˜äºä¸Šè¾¹ç•Œ â€” å†å²è¿‡çƒ­åŒº';
    bgColor   = 'rgba(252,92,101,0.12)';
    textColor = '#fc5c65';
  } else if (ratio < 1) {
    signal    = 'ğŸ”µ ä»·æ ¼ä½äºä¸­å¿ƒçº¿ â€” ä½ä¼°åŒºé—´ï¼ˆ' + ratio.toFixed(2) + 'xï¼‰';
    bgColor   = 'rgba(116,185,255,0.12)';
    textColor = '#74b9ff';
  } else {
    signal    = 'ğŸŸ¡ ä»·æ ¼é«˜äºä¸­å¿ƒçº¿ â€” é«˜ä¼°åŒºé—´ï¼ˆ' + ratio.toFixed(2) + 'xï¼‰';
    bgColor   = 'rgba(247,183,49,0.12)';
    textColor = '#f7b731';
  }

  badge.textContent           = signal;
  badge.style.background      = bgColor;
  badge.style.color           = textColor;
  badge.style.borderColor     = textColor + '40';
}

// â”€â”€ ç”Ÿæˆæœªæ¥æ—¥æœŸåºåˆ—ï¼ˆåˆ°2035å¹´ï¼Œæ¯æœˆä¸€ä¸ªç‚¹ï¼‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€
function generateFutureDates(lastDate) {
  var dates  = [];
  var cursor = new Date(lastDate);
  var end    = new Date('2035-01-01');
  cursor.setMonth(cursor.getMonth() + 1);
  while (cursor <= end) {
    dates.push(new Date(cursor));
    cursor.setMonth(cursor.getMonth() + 1);
  }
  return dates;
}

// â”€â”€ ç”»å›¾ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function drawChart(days, todayPrice, a, b, mult) {
  var futureDates = generateFutureDates(days[days.length - 1].date);
  var allDates    = days.map(function(d) { return d.date; }).concat(futureDates);

  // å†å²ä»·æ ¼çº¿
  var priceData = days.map(function(d) { return { x: d.date, y: d.price }; });

  // ä¸‰æ¡æ¨¡å‹çº¿ï¼ˆå†å² + æœªæ¥ï¼‰
  var centerData = allDates.map(function(d) { return { x: d, y: regressionPrice(d, a, b) }; });
  var upperData  = allDates.map(function(d) { return { x: d, y: regressionPrice(d, a, b) * mult.upper }; });
  var lowerData  = allDates.map(function(d) { return { x: d, y: regressionPrice(d, a, b) * mult.lower }; });

  // ä¸Šä¸‹è¾¹ç•Œä¹‹é—´çš„å¡«å……åŒºåŸŸ
  // ç”¨ fill è®©ä¸Šè¾¹ç•Œå¡«å……åˆ°ä¸‹è¾¹ç•Œ
  if (plChart) plChart.destroy();

  var ctx = document.getElementById('plChart').getContext('2d');
  plChart = new Chart(ctx, {
    type: 'line',
    data: {
      datasets: [
        {
          // ä¸Šè¾¹ç•Œ
          label: 'ä¸Šè¾¹ç•Œï¼ˆå†å²è¿‡çƒ­åŒºï¼‰',
          data: upperData,
          borderColor: 'rgba(252,92,101,0.7)',
          backgroundColor: 'rgba(252,92,101,0.06)',
          borderWidth: 1.5,
          borderDash: [5, 3],
          pointRadius: 0,
          tension: 0.2,
          fill: '+2',   // å¡«å……åˆ°ä¸‹è¾¹ç•Œï¼ˆä¸‹é¢ç¬¬2ä¸ªdatasetï¼‰
          yAxisID: 'y',
          order: 3,
        },
        {
          // ä¸­å¿ƒå›å½’çº¿
          label: 'ä¸­å¿ƒå›å½’çº¿ï¼ˆå¹‚å¾‹å…¬å…ä»·å€¼ï¼‰',
          data: centerData,
          borderColor: '#74b9ff',
          backgroundColor: 'transparent',
          borderWidth: 2,
          pointRadius: 0,
          tension: 0.2,
          fill: false,
          yAxisID: 'y',
          order: 2,
        },
        {
          // ä¸‹è¾¹ç•Œ
          label: 'ä¸‹è¾¹ç•Œï¼ˆå†å²ä½ä¼°åŒºï¼‰',
          data: lowerData,
          borderColor: 'rgba(38,222,129,0.7)',
          backgroundColor: 'rgba(38,222,129,0.06)',
          borderWidth: 1.5,
          borderDash: [5, 3],
          pointRadius: 0,
          tension: 0.2,
          fill: false,
          yAxisID: 'y',
          order: 4,
        },
        {
          // BTCå†å²ä»·æ ¼ï¼ˆæœ€ä¸Šå±‚ï¼‰
          label: 'BTC ä»·æ ¼',
          data: priceData,
          borderColor: '#f7b731',
          backgroundColor: 'transparent',
          borderWidth: 2,
          pointRadius: 0,
          tension: 0.15,
          fill: false,
          yAxisID: 'y',
          order: 1,
        },
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: { mode: 'index', intersect: false },
      plugins: {
        legend: {
          labels: {
            color: '#e8e8f0',
            font: { family: 'Space Mono, monospace', size: 11 },
            boxWidth: 24, padding: 16,
          }
        },
        tooltip: {
          backgroundColor: '#13131a',
          borderColor: '#1e1e2e',
          borderWidth: 1,
          titleColor: '#5a5a7a',
          bodyColor: '#e8e8f0',
          callbacks: {
            title: function(items) {
              return new Date(items[0].parsed.x).toLocaleDateString('zh-CN');
            },
            label: function(ctx) {
              if (ctx.parsed.y === null || ctx.parsed.y === undefined) return null;
              return ' ' + ctx.dataset.label + ': $' +
                ctx.parsed.y.toLocaleString('en-US', {maximumFractionDigits: 0});
            }
          }
        }
      },
      scales: {
        x: {
          type: 'time',
          time: { unit: 'year' },
          ticks: { color: '#5a5a7a', font: { family: 'Space Mono, monospace' } },
          grid:  { color: '#1e1e2e' },
        },
        y: {
          type: 'logarithmic',
          position: 'right',
          ticks: {
            color: '#5a5a7a',
            font: { family: 'Space Mono, monospace' },
            callback: function(v) {
              var neat = [0.01, 0.1, 1, 10, 100, 1000, 10000, 100000, 1000000, 10000000];
              return neat.indexOf(v) >= 0 ? '$' + v.toLocaleString() : '';
            }
          },
          grid: { color: '#1e1e2e' },
        }
      }
    }
  });
}

// â”€â”€ ä¸»æµç¨‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Promise.all([
  fetch('https://caroljx.github.io/btc-dashboard/btc_history.csv')
    .then(function(r) { return r.text(); }),
  fetch('https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT')
    .then(function(r) { return r.json(); })
])
.then(function(results) {
  var days       = parseCSV(results[0]);
  var todayPrice = parseFloat(results[1].price);

  if (!days.length || !todayPrice) {
    setStatus('error', 'âŒ æ•°æ®è§£æå¤±è´¥'); return;
  }

  // æ‹Ÿåˆå¹‚å¾‹å›å½’
  var reg  = fitPowerLaw(days);
  var mult = calcBandMultipliers(days, reg.a, reg.b);

  setStatus('ready',
    'âœ… å›å½’æ‹Ÿåˆå®Œæˆ â€” ' + days.length + ' å¤©æ•°æ® | ' +
    'ç³»æ•° a=' + reg.a.toFixed(4) + ', b=' + reg.b.toFixed(4) + ' | ' +
    'ä¸Šå€æ•°=' + mult.upper.toFixed(2) + 'x, ä¸‹å€æ•°=' + mult.lower.toFixed(2) + 'x'
  );

  updateStats(todayPrice, reg.a, reg.b, mult);
  drawChart(days, todayPrice, reg.a, reg.b, mult);
})
.catch(function(err) {
  setStatus('error', 'âŒ åŠ è½½å¤±è´¥ï¼š' + err.message);
});
</script>
</body>
</html>
